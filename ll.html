<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ReactNativeWebView Crash Test</title>
<style>
body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
button { margin: 5px 0; padding: 10px 15px; font-size: 14px; }
pre { background: #000; color: #0f0; padding: 10px; height: 200px; overflow: auto; }
select { padding: 5px; }
</style>
</head>
<body>

<h2>ReactNativeWebView Crash Test</h2>
<p>Klik tombol untuk kirim payload sekali, atau aktifkan <b>Auto Stress Test</b> untuk kirim terus-menerus.</p>

<h3>Manual Test</h3>
<button onclick="sendMalformedJSON()">Malformed JSON</button>
<button onclick="sendLongString()">Super Long String</button>
<button onclick="sendWeirdUnicode()">Weird Unicode</button>
<button onclick="sendDeepNestedJSON()">Deep Nested JSON</button>
<button onclick="sendBinaryData()">Binary Data</button>

<h3>Auto Stress Test</h3>
<select id="payloadType">
  <option value="malformed">Malformed JSON</option>
  <option value="longstring">Super Long String</option>
  <option value="unicode">Weird Unicode</option>
  <option value="deepnested">Deep Nested JSON</option>
  <option value="binary">Binary Data</option>
</select>
<input type="number" id="interval" value="2000" min="200" step="100"> ms
<button onclick="startAuto()">Start</button>
<button onclick="stopAuto()">Stop</button>

<pre id="log"></pre>

<script>
const log = msg => document.getElementById("log").textContent += "\n" + msg;

function post(msg) {
    try {
        if (window.ReactNativeWebView) {
            window.ReactNativeWebView.postMessage(msg);
            log("Sent: " + (msg.length > 100 ? msg.slice(0,100) + "..." : msg));
        } else {
            log("ReactNativeWebView not detected.");
        }
    } catch (e) {
        log("Error: " + e.message);
    }
}

// Payload generators
function sendMalformedJSON() {
    const payload = "{unclosed_json";
    post(payload);
}

function sendLongString() {
    const payload = "A".repeat(10_000_000);
    post(payload);
}

function sendWeirdUnicode() {
    const payload = "\u200F\u200D".repeat(5000);
    post(payload);
}

function sendDeepNestedJSON() {
    let nested = "1";
    for (let i = 0; i < 50000; i++) nested = `{"a":${nested}}`;
    post(nested);
}

function sendBinaryData() {
    const bin = atob("/////w==");
    post(bin);
}

// Auto mode
let autoTimer = null;

function startAuto() {
    stopAuto();
    const type = document.getElementById("payloadType").value;
    const interval = parseInt(document.getElementById("interval").value, 10);

    autoTimer = setInterval(() => {
        switch(type) {
            case "malformed": sendMalformedJSON(); break;
            case "longstring": sendLongString(); break;
            case "unicode": sendWeirdUnicode(); break;
            case "deepnested": sendDeepNestedJSON(); break;
            case "binary": sendBinaryData(); break;
        }
    }, interval);

    log(`Auto Stress Test started: ${type}, every ${interval} ms`);
}

function stopAuto() {
    if (autoTimer) {
        clearInterval(autoTimer);
        autoTimer = null;
        log("Auto Stress Test stopped.");
    }
}
</script>

</body>
</html>
